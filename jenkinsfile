
pipeline {
    agent any

 tools {
         nodejs 'Nodejs'
     
      }
    stages {
       stage ('Check Tools Initializing') {
            steps {
                sh' npm install -g @angular/cli'
                sh 'ng --version'
                sh 'node --version'
                sh 'npm -v'
               sh'docker --version'
                sh ''' echo "Nodejs = ${Nodejs}"
                '''
            }
              post {
        success { 
            slackSend channel: '#notification', color: 'good', message: "${env.STAGE_NAME} is Success", teamDomain: 'testnotifgroup', tokenCredentialId: 'slack-token'
        }
        unstable { 
            slackSend channel: '#notification', color: 'warning', message: "${env.STAGE_NAME} is Unstable", teamDomain: 'testnotifgroup', tokenCredentialId: 'slack-token'
        }
        failure { 
            slackSend channel: '#notification', color: 'danger', message: "${env.STAGE_NAME} is Failed", teamDomain: 'testnotifgroup', tokenCredentialId: 'slack-token'
        }
    }
        }
       stage('Git checkout') {
            steps {
               
             git branch: 'master',url:'https://github.com/mahabaraket/black-dashboard-angular.git'
            }
              post {
        success { 
            slackSend channel: '#notification', color: 'good', message: "${env.STAGE_NAME} is Success", teamDomain: 'testnotifgroup', tokenCredentialId: 'slack-token'
        }
        unstable { 
            slackSend channel: '#notification', color: 'warning', message: "${env.STAGE_NAME} is Unstable", teamDomain: 'testnotifgroup', tokenCredentialId: 'slack-token'
        }
        failure { 
            slackSend channel: '#notification', color: 'danger', message: "${env.STAGE_NAME} is Failed", teamDomain: 'testnotifgroup', tokenCredentialId: 'slack-token'
        }
    }
        }
           stage('Packages Installations') {
            steps {
               sh 'pwd'
              sh 'npm install'
            }
              post {
        success { 
            slackSend channel: '#notification', color: 'good', message: "${env.STAGE_NAME} is Success", teamDomain: 'testnotifgroup', tokenCredentialId: 'slack-token'
        }
        unstable { 
            slackSend channel: '#notification', color: 'warning', message: "${env.STAGE_NAME} is Unstable", teamDomain: 'testnotifgroup', tokenCredentialId: 'slack-token'
        }
        failure { 
            slackSend channel: '#notification', color: 'danger', message: "${env.STAGE_NAME} is Failed", teamDomain: 'testnotifgroup', tokenCredentialId: 'slack-token'
        }
    }
        }
           /*  stage('TEST') {
            steps {
              
           echo 'TEsTING ...'
             sh 'npm run test'
            }
        }*/
                   stage('BUILD') {
            steps {
              
           echo 'Build ...'
             sh 'npm run build'
            }
              post {
        success { 
            slackSend channel: '#notification', color: 'good', message: "${env.STAGE_NAME} is Success", teamDomain: 'testnotifgroup', tokenCredentialId: 'slack-token'
        }
        unstable { 
            slackSend channel: '#notification', color: 'warning', message: "${env.STAGE_NAME} is Unstable", teamDomain: 'testnotifgroup', tokenCredentialId: 'slack-token'
        }
        failure { 
            slackSend channel: '#notification', color: 'danger', message: "${env.STAGE_NAME} is Failed", teamDomain: 'testnotifgroup', tokenCredentialId: 'slack-token'
        }
    }
        }
        stage('Docker login') {
      steps {
         sh 'echo "Docker login is processing ...."'
        sh 'docker login --username mahabara --password Maha.12345'

      }
        post {
        success { 
            slackSend channel: '#notification', color: 'good', message: "${env.STAGE_NAME} is Success", teamDomain: 'testnotifgroup', tokenCredentialId: 'slack-token'
        }
        unstable { 
            slackSend channel: '#notification', color: 'warning', message: "${env.STAGE_NAME} is Unstable", teamDomain: 'testnotifgroup', tokenCredentialId: 'slack-token'
        }
        failure { 
            slackSend channel: '#notification', color: 'danger', message: "${env.STAGE_NAME} is Failed", teamDomain: 'testnotifgroup', tokenCredentialId: 'slack-token'
        }
    }
    }
         stage('Docker build image') {
      steps {
         sh 'echo "Docker build image is processing ...."'
         sh 'docker build -t mahabara/hidev .'

      }
        post {
        success { 
            slackSend channel: '#notification', color: 'good', message: "${env.STAGE_NAME} is Success", teamDomain: 'testnotifgroup', tokenCredentialId: 'slack-token'
        }
        unstable { 
            slackSend channel: '#notification', color: 'warning', message: "${env.STAGE_NAME} is Unstable", teamDomain: 'testnotifgroup', tokenCredentialId: 'slack-token'
        }
        failure { 
            slackSend channel: '#notification', color: 'danger', message: "${env.STAGE_NAME} is Failed", teamDomain: 'testnotifgroup', tokenCredentialId: 'slack-token'
        }
    }
    }
    
    stage('Docker push') {
      steps {
         sh 'echo "Docker push is processing ...."'
        sh 'docker push mahabara/hidev'

      }
        post {
        success { 
            slackSend channel: '#notification', color: 'good', message: "${env.STAGE_NAME} is Success", teamDomain: 'testnotifgroup', tokenCredentialId: 'slack-token'
        }
        unstable { 
            slackSend channel: '#notification', color: 'warning', message: "${env.STAGE_NAME} is Unstable", teamDomain: 'testnotifgroup', tokenCredentialId: 'slack-token'
        }
        failure { 
            slackSend channel: '#notification', color: 'danger', message: "${env.STAGE_NAME} is Failed", teamDomain: 'testnotifgroup', tokenCredentialId: 'slack-token'
        }
    }
    }
     stage('Docker Composs') {
      steps {
         sh 'echo "Docker compooss is processing ...."'
        sh 'docker compose up'

      }
        post {
        success { 
            slackSend channel: '#notification', color: 'good', message: "${env.STAGE_NAME} is Success", teamDomain: 'testnotifgroup', tokenCredentialId: 'slack-token'
        }
        unstable { 
            slackSend channel: '#notification', color: 'warning', message: "${env.STAGE_NAME} is Unstable", teamDomain: 'testnotifgroup', tokenCredentialId: 'slack-token'
        }
        failure { 
            slackSend channel: '#notification', color: 'danger', message: "${env.STAGE_NAME} is Failed", teamDomain: 'testnotifgroup', tokenCredentialId: 'slack-token'
        }
    }
    }
      }
      
      post {
 /*   success { mail to: "maha.neufone@gmail.com",
                    subject: "Build sucess",
                    body: "sucess"
             echo 'successful'}
    failure { mail to: "maha.neufone@gmail.com",
                    subject: "Jenkins Build failed",
                    body: "failed"
             echo 'failed'}*/
              always { mail to: "maha.neufone@gmail.com",
                    subject: "Jenkins Build :${currentBuild.currentResult} : ${env.JOB_NAME}",
                    body: "${currentBuild.currentResult}: Job ${env.JOB_NAME}\nMore Info can be found here: ${env.BUILD_URL}"
             echo 'failed'}
  }
  
}
